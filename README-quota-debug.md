# AI问书次数限制功能调试指南

## 问题诊断

如果在AI问书对话框中没有看到次数限制显示，请按以下步骤排查：

### 1. 检查配额功能是否正常
访问测试页面：`/dashboard/quota-test`

### 2. 检查网络请求
打开浏览器开发者工具 -> Network 标签页，查看是否有以下请求：
- `GET /api/chat-quota` - 获取配额信息

### 3. 检查控制台日志
打开浏览器开发者工具 -> Console 标签页，查看是否有相关错误信息

### 4. 确认显示位置
次数限制应显示在AI问书对话框的标题栏右侧，格式为：
- `剩余 X/10 次` (普通用户)
- `无限制` (Pro用户)

### 5. 颜色编码说明
- 🟣 紫色：Pro用户无限制
- 🔵 蓝色：剩余次数充足 (>3次)
- 🟡 黄色：剩余次数警告 (1-3次)
- 🔴 红色：次数已用完 (0次)

## 功能特性

1. **实时更新**：每次发送消息后自动减少剩余次数
2. **次数拦截**：次数用完时自动弹出升级提醒
3. **每日重置**：次数在每天0点自动重置
4. **会员区分**：
   - FREE/PLUS用户：每天10次
   - PRO用户：无限制

## 测试步骤

1. 访问 `/dashboard/mcp-test` 
2. 点击"配额功能测试页面"
3. 查看配额信息是否正确显示
4. 打开AI问书对话框
5. 确认标题栏显示次数信息

## 常见问题

### Q: 没有显示次数限制
A: 检查是否已登录，未登录用户也应显示"剩余 10/10 次"

### Q: 显示"剩余 NaN/10 次"
A: API返回数据格式错误，检查后端配额API

### Q: 点击发送没有减少次数
A: 检查useChatQuota函数是否正确调用

### Q: Pro用户显示了次数限制
A: 检查用户memberType是否正确设置为"PRO" 